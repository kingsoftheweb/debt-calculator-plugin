"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var i=0;i<e.length;i++){var o=e[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function _createClass(t,e,i){return e&&_defineProperties(t.prototype,e),i&&_defineProperties(t,i),t}var seppuku=!1;if(window.getComputedStyle){var testNode=document.createElement("div");["","-webkit-","-moz-","-ms-"].some((function(t){try{testNode.style.position=t+"sticky"}catch(t){}return""!=testNode.style.position}))&&(seppuku=!0)}else seppuku=!0;var shadowRootExists="undefined"!=typeof ShadowRoot,scroll={top:null,left:null},stickies=[];function extend(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])}function parseNumeric(t){return parseFloat(t)||0}function getDocOffsetTop(t){for(var e=0;t;)e+=t.offsetTop,t=t.offsetParent;return e}var Sticky=function(){function t(e){if(_classCallCheck(this,t),!(e instanceof HTMLElement))throw new Error("First argument must be HTMLElement");if(stickies.some((function(t){return t._node===e})))throw new Error("Stickyfill is already applied to this node");this._node=e,this._stickyMode=null,this._active=!1,stickies.push(this),this.refresh()}return _createClass(t,[{key:"refresh",value:function(){if(!seppuku&&!this._removed){this._active&&this._deactivate();var t=this._node,e=getComputedStyle(t),i={top:e.top,display:e.display,marginTop:e.marginTop,marginBottom:e.marginBottom,marginLeft:e.marginLeft,marginRight:e.marginRight,cssFloat:e.cssFloat};if(!isNaN(parseFloat(i.top))&&"table-cell"!=i.display&&"none"!=i.display){this._active=!0;var o=t.parentNode,n=shadowRootExists&&o instanceof ShadowRoot?o.host:o,s=t.getBoundingClientRect(),r=n.getBoundingClientRect(),a=getComputedStyle(n);this._parent={node:n,styles:{position:n.style.position},offsetHeight:n.offsetHeight},this._offsetToWindow={left:s.left,right:document.documentElement.clientWidth-s.right},this._offsetToParent={top:s.top-r.top-parseNumeric(a.borderTopWidth),left:s.left-r.left-parseNumeric(a.borderLeftWidth),right:-s.right+r.right-parseNumeric(a.borderRightWidth)},this._styles={position:t.style.position,top:t.style.top,bottom:t.style.bottom,left:t.style.left,right:t.style.right,width:t.style.width,marginTop:t.style.marginTop,marginLeft:t.style.marginLeft,marginRight:t.style.marginRight};var f=parseNumeric(i.top);this._limits={start:s.top+window.pageYOffset-f,end:r.top+window.pageYOffset+n.offsetHeight-parseNumeric(a.borderBottomWidth)-t.offsetHeight-f-parseNumeric(i.marginBottom)};var l=a.position;"absolute"!=l&&"relative"!=l&&(n.style.position="relative"),this._recalcPosition();var c=this._clone={};c.node=document.createElement("div"),extend(c.node.style,{width:s.right-s.left+"px",height:s.bottom-s.top+"px",marginTop:i.marginTop,marginBottom:i.marginBottom,marginLeft:i.marginLeft,marginRight:i.marginRight,cssFloat:i.cssFloat,padding:0,border:0,borderSpacing:0,fontSize:"1em",position:"static"}),o.insertBefore(c.node,t),c.docOffsetTop=getDocOffsetTop(c.node)}}}},{key:"_recalcPosition",value:function(){if(this._active&&!this._removed){var t=scroll.top<=this._limits.start?"start":scroll.top>=this._limits.end?"end":"middle";if(this._stickyMode!=t){switch(t){case"start":extend(this._node.style,{position:"absolute",left:this._offsetToParent.left+"px",right:this._offsetToParent.right+"px",top:this._offsetToParent.top+"px",bottom:"auto",width:"auto",marginLeft:0,marginRight:0,marginTop:0});break;case"middle":extend(this._node.style,{position:"fixed",left:this._offsetToWindow.left+"px",right:this._offsetToWindow.right+"px",top:this._styles.top,bottom:"auto",width:"auto",marginLeft:0,marginRight:0,marginTop:0});break;case"end":extend(this._node.style,{position:"absolute",left:this._offsetToParent.left+"px",right:this._offsetToParent.right+"px",top:"auto",bottom:0,width:"auto",marginLeft:0,marginRight:0})}this._stickyMode=t}}}},{key:"_fastCheck",value:function(){this._active&&!this._removed&&(Math.abs(getDocOffsetTop(this._clone.node)-this._clone.docOffsetTop)>1||Math.abs(this._parent.node.offsetHeight-this._parent.offsetHeight)>1)&&this.refresh()}},{key:"_deactivate",value:function(){var t=this;this._active&&!this._removed&&(this._clone.node.parentNode.removeChild(this._clone.node),delete this._clone,extend(this._node.style,this._styles),delete this._styles,stickies.some((function(e){return e!==t&&e._parent&&e._parent.node===t._parent.node}))||extend(this._parent.node.style,this._parent.styles),delete this._parent,this._stickyMode=null,this._active=!1,delete this._offsetToWindow,delete this._offsetToParent,delete this._limits)}},{key:"remove",value:function(){var t=this;this._deactivate(),stickies.some((function(e,i){if(e._node===t._node)return stickies.splice(i,1),!0})),this._removed=!0}}]),t}(),Stickyfill={stickies:stickies,Sticky:Sticky,addOne:function(t){if(!(t instanceof HTMLElement)){if(!t.length||!t[0])return;t=t[0]}for(var e=0;e<stickies.length;e++)if(stickies[e]._node===t)return stickies[e];return new Sticky(t)},add:function(t){if(t instanceof HTMLElement&&(t=[t]),t.length){for(var e=[],i=function(i){var o=t[i];return o instanceof HTMLElement?stickies.some((function(t){if(t._node===o)return e.push(t),!0}))?"continue":void e.push(new Sticky(o)):(e.push(void 0),"continue")},o=0;o<t.length;o++)i(o);return e}},refreshAll:function(){stickies.forEach((function(t){return t.refresh()}))},removeOne:function(t){if(!(t instanceof HTMLElement)){if(!t.length||!t[0])return;t=t[0]}stickies.some((function(e){if(e._node===t)return e.remove(),!0}))},remove:function(t){if(t instanceof HTMLElement&&(t=[t]),t.length)for(var e=function(e){var i=t[e];stickies.some((function(t){if(t._node===i)return t.remove(),!0}))},i=0;i<t.length;i++)e(i)},removeAll:function(){for(;stickies.length;)stickies[0].remove()}};function init(){function t(){window.pageXOffset!=scroll.left?(scroll.top=window.pageYOffset,scroll.left=window.pageXOffset,Stickyfill.refreshAll()):window.pageYOffset!=scroll.top&&(scroll.top=window.pageYOffset,scroll.left=window.pageXOffset,stickies.forEach((function(t){return t._recalcPosition()})))}var e,i,o;function n(){e=setInterval((function(){stickies.forEach((function(t){return t._fastCheck()}))}),500)}t(),window.addEventListener("scroll",t),window.addEventListener("resize",Stickyfill.refreshAll),window.addEventListener("orientationchange",Stickyfill.refreshAll),"hidden"in document?(i="hidden",o="visibilitychange"):"webkitHidden"in document&&(i="webkitHidden",o="webkitvisibilitychange"),o?(document[i]||n(),document.addEventListener(o,(function(){document[i]?clearInterval(e):n()}))):n()}seppuku||init(),"undefined"!=typeof module&&module.exports?module.exports=Stickyfill:window.Stickyfill=Stickyfill;