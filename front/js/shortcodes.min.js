var dcmShortcodes={debtCalculator:{elements:{singleTabs:document.querySelectorAll(".single-grid-tab"),contentTabs:document.querySelectorAll(".arm_account_detail_tab.arm_account_detail_tab_content"),resultsTabs:document.querySelectorAll("td.arm-form-table-content.tab-has-result .title"),totalDebtInfo:document.querySelector(".total-debts-chart__main"),allDebtsInfo:document.querySelector(".total-debts-chart__main.all_debts"),monthlyPayments:document.querySelector(".total-debts-chart__main.all_debts.per_month input"),monthlyPaymentsDiv:document.querySelector(".total-logs-per-month"),yearlyPaymentsDiv:document.querySelector(".yearly-payments-chart__main"),monthlyLogs:document.querySelectorAll(".multi-graphics-wrapper input.order_logs_per_month"),addNewButton:document.querySelector(".dcm-shortcode input.submit.add-new-debt"),updateButtons:document.querySelectorAll(".dcm-shortcode input.submit.update-debt"),exportPDF:document.querySelector(".export-current-debt a.export-pdf")},events:function(){var e=dcmShortcodes.debtCalculator;window.onload=function(){e.functions.parseUrl(),e.functions.reportsCharts.singleDebt(),e.functions.reportsCharts.totalDebts()},e.elements.singleTabs.forEach((function(t){t.addEventListener("click",(function(){var a=t.getAttribute("data-id");e.functions.showTab(a),e.functions.updateUrl(a)}))})),e.elements.resultsTabs.forEach((function(t){t.addEventListener("click",(function(){t.parentElement.classList.contains("open")?t.parentElement.classList.remove("open"):(e.elements.resultsTabs.forEach((function(e){e.parentElement.classList.remove("open")})),t.parentElement.classList.add("open"))}))})),e.elements.addNewButton.addEventListener("click",(function(){e.functions.addNewDebt(e.elements.addNewButton)})),e.elements.updateButtons.forEach((function(t){t.addEventListener("click",(function(){e.functions.updateDebt(t)}))})),e.elements.exportPDF.addEventListener("click",(function(){var t=e.elements.exportPDF.getAttribute("data-href"),a=e.elements.exportPDF.getAttribute("data-userID"),n=e.elements.exportPDF.getAttribute("data-meta"),r=dcmShortcodes.debtCalculator.elements.totalDebtInfo.querySelector("canvas"),o=dcmShortcodes.debtCalculator.elements.allDebtsInfo.querySelector("canvas"),l=dcmShortcodes.debtCalculator.elements.yearlyPaymentsDiv.querySelector("canvas"),s=document.querySelector(".single-month-chart.show canvas");dcpExportHTML.functions.pdfExport(r,o,l,s,a,t,n)}))},functions:{showTab:function(e){dcmShortcodes.debtCalculator.elements.singleTabs.forEach((function(e){e.classList.remove("active")})),document.querySelector('.single-grid-tab[data-id="'+e+'"]').classList.add("active"),dcmShortcodes.debtCalculator.elements.contentTabs.forEach((function(e){e.classList.remove("active")})),document.querySelector('.arm_account_detail_tab.arm_account_detail_tab_content[data-tab="'+e+'"]').classList.add("active");var t=parseInt(document.querySelector(".arm-tabs.dcm-wrapper.dcm-shortcode").offsetHeight)+parseInt(document.querySelector(".arm-tabs.dcm-wrapper.dcm-shortcode").offsetTop);window.scrollTo({top:t,left:0,behavior:"smooth"})},parseUrl:function(){var e=new URL(location.href),t=e.searchParams.get("tab"),a=e.searchParams.get("debt_id");return null!==t?(dcmShortcodes.debtCalculator.functions.showTab(t),a):null},updateUrl:function(e){var t=new URL(location.href),a=t.searchParams.get("user_id");if(console.log(a),null!==a){var n="?user_id="+a+"&tab="+e;return history.pushState(null,"",n),n}return history.pushState(null,"",t.pathname+"?tab="+e),t.pathname+"?tab="+e},addNewDebt:function(e){var t=e.parentElement.parentElement.parentElement.querySelector('input[name="author_id"]').value,a=e.parentElement.parentElement.parentElement.querySelector('input[name="debt_name"]'),n=e.parentElement.parentElement.querySelector('input[name="debt_amount"]'),r=e.parentElement.parentElement.querySelector('input[name="yearly_interest"]');""===a.value||""===n.value||""===r.value?alert("Fill All Fields please."):jQuery.post(dcp_object.ajaxurl,{action:"add_dcp_debt",debt_title:a.value,debt_amount:n.value,yearly_interest:r.value,author_id:t},(function(e){var t=dcmShortcodes.debtCalculator.functions.updateUrl("debts-reports&debt_id="+e);location.href=t}))},updateDebt:function(e){var t=e.parentElement.parentElement.querySelector('input[name="debt_id"]').value,a=e.parentElement.parentElement.querySelector('input[name="pay_amount"]'),n=e.parentElement.parentElement.querySelector('input[name="remaining"]').value,r=e.parentElement.parentElement.querySelector('input[name="interest"]').value;""===a?alert("Fill the Amount Field please."):jQuery.post(dcp_object.ajaxurl,{action:"update_dcp_debt",debtID:t,paid:a.value,remaining:n,interest:r},(function(e){var t=dcmShortcodes.debtCalculator.functions.updateUrl("debts-reports&debt_id="+e);location.href=t}))},reportsCharts:{totalDebts:function(){var e=JSON.parse(dcmShortcodes.debtCalculator.elements.monthlyPayments.value);e.length>0&&e.forEach((function(t,a){console.log(t);var n=t.start_date,r=t.end_date,o=0===a?"":'<i class="fa fa-arrow-left arrow-direction"></i>',l=a===e.length-1?"":'<i class="fa fa-arrow-right arrow-direction"></i>',s=a===e.length-1?"show":"hide",c=document.createElement("div");c.classList.add("single-month-chart",s),c.setAttribute("data-index",a),c.insertAdjacentHTML("afterbegin",'<div class="monthly-header" data-index = "'+a+'"><span class="arrow" data-direction ="back" data-index = "'+a+'">'+o+'</span><span class="start-date">'+n+'</span><span class="middle-icon">-</span><span class="end-date">'+r+'</span><span class="arrow" data-direction ="forward" data-index = "'+a+'">'+l+"</span></div>"),dcmShortcodes.debtCalculator.elements.monthlyPayments.insertAdjacentElement("afterend",c),c.querySelectorAll(".monthly-header .arrow i").forEach((function(e){e.addEventListener("click",(function(){console.log(e);var t=e.parentElement.getAttribute("data-index"),a=0;switch(e.parentElement.getAttribute("data-direction")){case"forward":a=parseInt(t)+1;break;case"back":a=parseInt(t)-1}document.querySelectorAll(".single-month-chart").forEach((function(e){e.classList.remove("show")})),document.querySelector('.single-month-chart[data-index="'+a+'"]').classList.add("show")}))}));var d=document.createElement("canvas");d.classList.add("total-logs-per-month","line-chart"),d.setAttribute("debt-id",0),d.setAttribute("data-start_date",n),d.setAttribute("data-end_date",r),c.insertAdjacentElement("beforeend",d),createChart.functions.drawChart(d,0,"doughnut",debtValuesJson=null,t);var i='<table class = "all-payments-per-month"><tbody>';t.debts.forEach((function(e){var t=parseFloat(e.debt_values.total_paid)/(parseFloat(e.debt_values.total_paid)+parseFloat(e.debt_values.remaining));t=(t=Math.round(100*t))||0,i+="<tr><td>"+e.title+"</td><td>$"+e.debt_values.total_paid+"</td><td>"+t+"%</td></tr>"})),i+="</tbody></table>",c.insertAdjacentHTML("beforeend",i)}));var t=JSON.parse(dcmShortcodes.debtCalculator.elements.yearlyPaymentsDiv.querySelector("input[name=yearly_payments_values]").value),a=[];t.forEach((function(e){var t=0;e.debts.forEach((function(e){t+=parseFloat(e.debt_values.total_paid)})),a.push({year:e.year,total_paid:t})}));var n=dcmShortcodes.debtCalculator.elements.yearlyPaymentsDiv.querySelector("canvas.yearly-payments-canvas");createChart.functions.drawLineCombined(n,a,{title:"Yearly Payments"});var r=dcmShortcodes.debtCalculator.elements.totalDebtInfo.querySelector('input[name="total_debts_info"]').value,o=dcmShortcodes.debtCalculator.elements.totalDebtInfo.querySelector("canvas.total-debts-canvas");createChart.functions.drawChart(o,o.getAttribute("data-id"),"doughnut",r);var l=dcmShortcodes.debtCalculator.elements.allDebtsInfo.querySelector('input[name="total_debts_info"]').value,s=dcmShortcodes.debtCalculator.elements.allDebtsInfo.querySelector('input[name="total_debts_info_labels"]').value,c=dcmShortcodes.debtCalculator.elements.allDebtsInfo.querySelector("canvas.total-debts-canvas");createChart.functions.drawDoughnutCombined(c,JSON.parse(l),JSON.parse(s))},singleDebt:function(){document.querySelectorAll("canvas.debts-reports.doughnut-chart").forEach((function(e){createChart.functions.drawChart(e,e.getAttribute("data-id"),"doughnut")})),dcmShortcodes.debtCalculator.elements.monthlyLogs.forEach((function(e){var t=JSON.parse(e.value),a=dcmShortcodes.debtCalculator.generalFunctions.converMonthLogsToYearLogs(t),n=0,r=0;a.length>0&&(n=a[0].year,r=a[a.length-1].year);for(var o=[],l=n;l<=r;l++){var s=dcmShortcodes.debtCalculator.generalFunctions.getYearLogs(l,a);o.push({year:l,data:s})}var c=e.getAttribute("data-id");t.forEach((function(a,n){var r=a.start_date,o=a.end_date,l=0===n?"":'<i class="fa fa-arrow-left arrow-direction"></i>',s=n===t.length-1?"":'<i class="fa fa-arrow-right arrow-direction"></i>',d=n===t.length-1?"show":"hide",i=document.createElement("div");i.classList.add("single-month-chart",d),i.setAttribute("data-index",n),i.insertAdjacentHTML("afterbegin",'<div class="monthly-header" data-index = "'+n+'"><span class="arrow" data-direction ="back" data-index = "'+n+'">'+l+'</span><span class="start-date">'+r+'</span><span class="middle-icon">-</span><span class="end-date">'+o+'</span><span class="arrow" data-direction ="forward" data-index = "'+n+'">'+s+"</span></div>"),e.insertAdjacentElement("afterend",i),i.querySelectorAll(".monthly-header .arrow i").forEach((function(e){e.addEventListener("click",(function(){console.log(e);var t=e.parentElement.getAttribute("data-index"),a=0;switch(e.parentElement.getAttribute("data-direction")){case"forward":a=parseInt(t)+1;break;case"back":a=parseInt(t)-1}document.querySelectorAll(".single-month-chart").forEach((function(e){e.classList.remove("show")})),document.querySelector('.single-month-chart[data-index="'+a+'"]').classList.add("show")}))}));var u=document.createElement("canvas");u.classList.add("total-logs-per-month","line-chart"),u.setAttribute("debt-id",c),u.setAttribute("data-start_date",r),u.setAttribute("data-end_date",o),i.insertAdjacentElement("beforeend",u),createChart.functions.drawChart(u,c,"doughnut",debtValuesJson=null,a)})),o.forEach((function(e){var t=document.createElement("canvas");t.classList.add("total-logs-per-month","line-chart"),t.setAttribute("debt-id",c),document.querySelector('.reports-graphics[data-id="'+c+'"] .multi-graphics-wrapper').insertAdjacentElement("beforeend",t),createChart.functions.drawLineChartPerYear(t,e,{title:e.year})}))}))}}},generalFunctions:{converMonthLogsToYearLogs:function(e){var t=[];return e.forEach((function(e){var a=e.start_date.split("-");a=a[1]+"-"+a[0]+"-"+a[2];var n=0;e.debt_logs.forEach((function(e){n+=parseFloat(e.paid)})),t.push({paymentsTotal:n,month:new Date(a).getMonth()+1,year:new Date(a).getFullYear(),title:e.title})})),t},getYearLogs:function(e,t){var a=[];return[[1,"Jan"],[2,"Feb"],[3,"Mar"],[4,"Apr"],[5,"May"],[6,"Jun"],[7,"Jul"],[8,"Aug"],[9,"Sep"],[10,"Oct"],[11,"Nov"],[12,"Dec"]].forEach((function(n){var r=n[0],o=n[1],l=0,s="";t.length>0?t.forEach((function(t){t.year===e&&t.month===r&&(l=t.paymentsTotal,s=t.title)})):console.log("there are no years logs"),a.push({month:o,index:r,payments:l,title:s})})),a}},init:function(){dcmShortcodes.debtCalculator.events()}}};window.addEventListener("DOMContentLoaded",(function(e){document.querySelectorAll(".dcm-shortcode").length>0&&dcmShortcodes.debtCalculator.init()}));